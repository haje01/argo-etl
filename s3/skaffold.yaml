apiVersion: skaffold/v4beta3
kind: Config
build:
  artifacts:
  - image: s3-etl
    context: etl
deploy:
  helm:
    # 패키지 설치전 처리 
    hooks: 
      before:
      - host:
          command: ["sh", "init.sh"]
          os: [darwin, linux]  
    releases:
    - name: s3-sns
      chartPath: setup
      # 무한 배포를 막기 위해 변수별 파일 이용 
      valuesFiles:
      - svals/topic-arn.yaml
      - svals/ingress-addr.yaml
      setValueTemplates:
        image: '{{.IMAGE_FULLY_QUALIFIED_s3_etl}}'
